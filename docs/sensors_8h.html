<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rc-car: sensors.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="docs.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">rc-car
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5c982d53a68cdbcd421152b4020263a9.html">main</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">sensors.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;inttypes.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for sensors.h:</div>
<div class="dyncontent">
<div class="center"><img src="sensors_8h__incl.png" border="0" usemap="#asensors_8h" alt=""/></div>
<map name="asensors_8h" id="asensors_8h">
<area shape="rect" title="Macros and functions for sensors and actuators." alt="" coords="7,5,91,31"/>
<area shape="rect" title=" " alt="" coords="5,79,92,104"/>
<area shape="poly" title=" " alt="" coords="51,31,51,65,46,65,46,31"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="sensors_8h__dep__incl.png" border="0" usemap="#asensors_8hdep" alt=""/></div>
<map name="asensors_8hdep" id="asensors_8hdep">
<area shape="rect" title="Macros and functions for sensors and actuators." alt="" coords="47,5,131,31"/>
<area shape="rect" href="rc-car_8c_source.html" title=" " alt="" coords="5,79,75,104"/>
<area shape="poly" title=" " alt="" coords="76,44,50,80,46,77,71,41"/>
<area shape="rect" href="sensors_8c_source.html" title=" " alt="" coords="99,79,181,104"/>
<area shape="poly" title=" " alt="" coords="108,41,134,77,130,80,104,44"/>
</map>
</div>
</div>
<p><a href="sensors_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmeasurements__data.html">measurements_data</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a06e646d1fd3953e71bc679f2781dc806"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#a06e646d1fd3953e71bc679f2781dc806">SENSOR_H</a></td></tr>
<tr class="separator:a06e646d1fd3953e71bc679f2781dc806"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3324b4fc3b16d01c04b9931ec5a7b75d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#a3324b4fc3b16d01c04b9931ec5a7b75d">CSV_BUFF_SIZE</a>&#160;&#160;&#160;60</td></tr>
<tr class="separator:a3324b4fc3b16d01c04b9931ec5a7b75d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr><td colspan="2"><div class="groupHeader">GPIO pins</div></td></tr>
<tr class="memitem:a0361e4ff120962e55ba00a7aeb499276"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#a0361e4ff120962e55ba00a7aeb499276">THROTTLE_OUT_GPIO</a>&#160;&#160;&#160;33</td></tr>
<tr class="separator:a0361e4ff120962e55ba00a7aeb499276"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a654e9b1744e01af0d5a98db783542e35"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#a654e9b1744e01af0d5a98db783542e35">THROTTLE_IN_GPIO</a>&#160;&#160;&#160;34</td></tr>
<tr class="separator:a654e9b1744e01af0d5a98db783542e35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf1e0eab869bb642611ebd0ada384178"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#acf1e0eab869bb642611ebd0ada384178">TACHOMETER_GPIO</a>&#160;&#160;&#160;35</td></tr>
<tr class="separator:acf1e0eab869bb642611ebd0ada384178"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf368e3d9442f752c3eab88c785f32ab"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#aaf368e3d9442f752c3eab88c785f32ab">HC_SR04_TRIG_GPIO</a>&#160;&#160;&#160;16</td></tr>
<tr class="separator:aaf368e3d9442f752c3eab88c785f32ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8239c5fea5893172e3b381c13ea5b4bf"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#a8239c5fea5893172e3b381c13ea5b4bf">HC_SR04_ECHO_GPIO</a>&#160;&#160;&#160;17</td></tr>
<tr class="separator:a8239c5fea5893172e3b381c13ea5b4bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr><td colspan="2"><div class="groupHeader">Sample rates.</div></td></tr>
<tr class="memitem:a48e65c5aab10321436054a86e830a343"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#a48e65c5aab10321436054a86e830a343">VELO_MEAS_PERIOD_MS</a>&#160;&#160;&#160;200</td></tr>
<tr class="separator:a48e65c5aab10321436054a86e830a343"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4962d63e113f1d1de4c521f55c9125a3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#a4962d63e113f1d1de4c521f55c9125a3">DISTANCE_MEAS_PERIOD_MS</a>&#160;&#160;&#160;100</td></tr>
<tr class="separator:a4962d63e113f1d1de4c521f55c9125a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr><td colspan="2"><div class="groupHeader">Hardware specifications</div></td></tr>
<tr class="memitem:abda0a462ab3314e7198af36bf5e3e525"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#abda0a462ab3314e7198af36bf5e3e525">ROT_VEL_MAX</a>&#160;&#160;&#160;6000.0</td></tr>
<tr class="separator:abda0a462ab3314e7198af36bf5e3e525"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af79064a5dbf95cf506bc27bdabbcf037"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#af79064a5dbf95cf506bc27bdabbcf037">TACHO_COUNTS_PER_REVOLUTION</a>&#160;&#160;&#160;8</td></tr>
<tr class="separator:af79064a5dbf95cf506bc27bdabbcf037"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76fe84d83b8d236bd4f0d20d7e2ed06f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#a76fe84d83b8d236bd4f0d20d7e2ed06f">PWM_FREQ</a>&#160;&#160;&#160;74</td></tr>
<tr class="separator:a76fe84d83b8d236bd4f0d20d7e2ed06f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bd0f8a90f3ff4eb6a8da172f5b874ad"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#a3bd0f8a90f3ff4eb6a8da172f5b874ad">THROTTLE_STATIONARY_DUTY</a>&#160;&#160;&#160;11.258452</td></tr>
<tr class="separator:a3bd0f8a90f3ff4eb6a8da172f5b874ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ac61e98212a80fbe6dd044cba3585a698"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structmeasurements__data.html">measurements_data</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#ac61e98212a80fbe6dd044cba3585a698">measurements_data</a></td></tr>
<tr class="separator:ac61e98212a80fbe6dd044cba3585a698"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac5ec1d578591899e43c3515d05e573b7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#ac5ec1d578591899e43c3515d05e573b7">sensors_init</a> (void)</td></tr>
<tr class="separator:ac5ec1d578591899e43c3515d05e573b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae82ba7fadc40ef6388fb6e9e8d49b0d"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#aae82ba7fadc40ef6388fb6e9e8d49b0d">get_velocity</a> (void)</td></tr>
<tr class="separator:aae82ba7fadc40ef6388fb6e9e8d49b0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a616528e35ee0a88227957f3671c9d78a"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#a616528e35ee0a88227957f3671c9d78a">get_throttle_in_duty</a> (void)</td></tr>
<tr class="separator:a616528e35ee0a88227957f3671c9d78a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abaee63e3d3ae27b5b347b34a61370ada"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#abaee63e3d3ae27b5b347b34a61370ada">get_distance</a> (void)</td></tr>
<tr class="separator:abaee63e3d3ae27b5b347b34a61370ada"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab56e9687c1c23157ca48a4e2b7a344f9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#ab56e9687c1c23157ca48a4e2b7a344f9">set_throttle_duty</a> (float duty)</td></tr>
<tr class="separator:ab56e9687c1c23157ca48a4e2b7a344f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a836ed20956f87c11ecceef6bd2155b05"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#a836ed20956f87c11ecceef6bd2155b05">get_measurements</a> (<a class="el" href="structmeasurements__data.html">measurements_data</a> *data)</td></tr>
<tr class="separator:a836ed20956f87c11ecceef6bd2155b05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61c686e72f94452c023d1513280d8a93"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensors_8h.html#a61c686e72f94452c023d1513280d8a93">measurements_to_csv</a> (char *buffer, <a class="el" href="structmeasurements__data.html">measurements_data</a> *data)</td></tr>
<tr class="separator:a61c686e72f94452c023d1513280d8a93"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Macros and functions for sensors and actuators. </p>
<dl class="section author"><dt>Author</dt><dd>Czira Bence (<a href="#" onclick="location.href='mai'+'lto:'+'czi'+'ra'+'ben'+'ce'+'@gm'+'ai'+'l.c'+'om'; return false;">czira<span class="obfuscator">.nosp@m.</span>benc<span class="obfuscator">.nosp@m.</span>e@gma<span class="obfuscator">.nosp@m.</span>il.c<span class="obfuscator">.nosp@m.</span>om</a>)</dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2023-06-12</dd></dl>
<p>This header contains the macros and functions for setting up peripherals, reading sensors and controlling the speed controller of the rc car. Peripherals were configured using the esp-idf driver modules: periodic tasks were scheduled with ESP Timer, PWM duty cycles are read with the capture timer functionality of the MCPWM module, input pulses are counted using the pulse counter (PCNT) module and PWM signals are generated with the LEDC module. Spinlocks are used to ensure interrupt protection of variables holding measurement values.</p>
<ul>
<li><b> Tachometer </b> pulses on <a class="el" href="sensors_8h.html#acf1e0eab869bb642611ebd0ada384178" title="tachometer signal">TACHOMETER_GPIO</a> are counted using the PCNT module. Periodic reading of the counter is triggered in every <a class="el" href="sensors_8h.html#a4962d63e113f1d1de4c521f55c9125a3" title="sample rate of distance measurements [ms]">DISTANCE_MEAS_PERIOD_MS</a> by an esp_timer. Both the rising and falling edges of the tachometer signal are counted, which sum up to <a class="el" href="sensors_8h.html#af79064a5dbf95cf506bc27bdabbcf037" title="tachometer resolution [counts/revolution]">TACHO_COUNTS_PER_REVOLUTION</a>. <dl class="section note"><dt>Note</dt><dd>Rotational velocity can be obtained with <a class="el" href="sensors_8h.html#aae82ba7fadc40ef6388fb6e9e8d49b0d" title="Get last tachometer measurement taken on TACHOMETER_GPIO.">get_velocity()</a>.</dd></dl>
</li>
<li><b> Throttle command output </b> on <a class="el" href="sensors_8h.html#a0361e4ff120962e55ba00a7aeb499276" title="pwm throttle command output">THROTTLE_OUT_GPIO</a> is implemented using the LEDC module. The PWM frequency is defined by <a class="el" href="sensors_8h.html#a76fe84d83b8d236bd4f0d20d7e2ed06f" title="pwm frequency of speed controller [Hz]">PWM_FREQ</a>. The rc car goes in the forward and reverse direction for a duty cycle greater and smaller than <a class="el" href="sensors_8h.html#a3bd0f8a90f3ff4eb6a8da172f5b874ad" title="speed controller duty cycle when motor is stopped [%]">THROTTLE_STATIONARY_DUTY</a> respectively. <dl class="section note"><dt>Note</dt><dd>Throttle output duty cycle can be set via <a class="el" href="sensors_8h.html#ab56e9687c1c23157ca48a4e2b7a344f9" title="Set duty cycle for THROTTLE_OUT_GPIO.">set_throttle_duty()</a>.</dd></dl>
</li>
<li>The<b> throttle command input</b> is normally sent by the rc receiver to the speed controller. In the scope of this project, the esp32 microcontroller is placed between these two components in the control loop in order to execute Advanced Driver-Assistance tasks. The rc receiver output is connected to <a class="el" href="sensors_8h.html#a654e9b1744e01af0d5a98db783542e35" title="pwm throttle command input">THROTTLE_IN_GPIO</a>, and its duty cycle is measured with a capture timer from the MCPWM module. <dl class="section note"><dt>Note</dt><dd>Get throttle input duty cycle with <a class="el" href="sensors_8h.html#a616528e35ee0a88227957f3671c9d78a" title="Get duty cycle measured on THROTTLE_IN_GPIO.">get_throttle_in_duty()</a>.</dd></dl>
</li>
<li><b> Ultrasonic distance measurements </b> are taken with an HC-SR04 sensor placed on the front of the car. In every <a class="el" href="sensors_8h.html#a4962d63e113f1d1de4c521f55c9125a3" title="sample rate of distance measurements [ms]">DISTANCE_MEAS_PERIOD_MS</a>, a trigger signal is sent to the sensor on <a class="el" href="sensors_8h.html#aaf368e3d9442f752c3eab88c785f32ab" title="ultrasonic sensor trigger pin">HC_SR04_TRIG_GPIO</a>, then the time of flight (tof) of echoed ultrasound is measured on <a class="el" href="sensors_8h.html#a8239c5fea5893172e3b381c13ea5b4bf" title="ultrasonic sensor echo pin">HC_SR04_ECHO_GPIO</a>. The trigger signal is scheduled by an esp_timer, while tof is measured with a capture timer. <dl class="section note"><dt>Note</dt><dd>Retreive distance measurements with <a class="el" href="sensors_8h.html#abaee63e3d3ae27b5b347b34a61370ada" title="Compute distance from HC-SR04 measurements. Time of flight of the reflected ultrasound is halfed and ...">get_distance()</a>. </dd>
<dd>
HC-SR04 distance measurement was implemented according to the <b> mcpwm_capture_hc_sr04 </b> project from esp-idf builtin examples. </dd></dl>
</li>
</ul>

<p class="definition">Definition in file <a class="el" href="sensors_8h_source.html">sensors.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a3324b4fc3b16d01c04b9931ec5a7b75d" name="a3324b4fc3b16d01c04b9931ec5a7b75d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3324b4fc3b16d01c04b9931ec5a7b75d">&#9670;&#160;</a></span>CSV_BUFF_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CSV_BUFF_SIZE&#160;&#160;&#160;60</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sensors_8h_source.html#l00111">111</a> of file <a class="el" href="sensors_8h_source.html">sensors.h</a>.</p>

</div>
</div>
<a id="a4962d63e113f1d1de4c521f55c9125a3" name="a4962d63e113f1d1de4c521f55c9125a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4962d63e113f1d1de4c521f55c9125a3">&#9670;&#160;</a></span>DISTANCE_MEAS_PERIOD_MS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DISTANCE_MEAS_PERIOD_MS&#160;&#160;&#160;100</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>sample rate of distance measurements [ms] </p>

<p class="definition">Definition at line <a class="el" href="sensors_8h_source.html#l00083">83</a> of file <a class="el" href="sensors_8h_source.html">sensors.h</a>.</p>

</div>
</div>
<a id="a8239c5fea5893172e3b381c13ea5b4bf" name="a8239c5fea5893172e3b381c13ea5b4bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8239c5fea5893172e3b381c13ea5b4bf">&#9670;&#160;</a></span>HC_SR04_ECHO_GPIO</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HC_SR04_ECHO_GPIO&#160;&#160;&#160;17</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ultrasonic sensor echo pin </p>

<p class="definition">Definition at line <a class="el" href="sensors_8h_source.html#l00069">69</a> of file <a class="el" href="sensors_8h_source.html">sensors.h</a>.</p>

</div>
</div>
<a id="aaf368e3d9442f752c3eab88c785f32ab" name="aaf368e3d9442f752c3eab88c785f32ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf368e3d9442f752c3eab88c785f32ab">&#9670;&#160;</a></span>HC_SR04_TRIG_GPIO</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HC_SR04_TRIG_GPIO&#160;&#160;&#160;16</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ultrasonic sensor trigger pin </p>

<p class="definition">Definition at line <a class="el" href="sensors_8h_source.html#l00065">65</a> of file <a class="el" href="sensors_8h_source.html">sensors.h</a>.</p>

</div>
</div>
<a id="a76fe84d83b8d236bd4f0d20d7e2ed06f" name="a76fe84d83b8d236bd4f0d20d7e2ed06f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76fe84d83b8d236bd4f0d20d7e2ed06f">&#9670;&#160;</a></span>PWM_FREQ</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PWM_FREQ&#160;&#160;&#160;74</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>pwm frequency of speed controller [Hz] </p>

<p class="definition">Definition at line <a class="el" href="sensors_8h_source.html#l00102">102</a> of file <a class="el" href="sensors_8h_source.html">sensors.h</a>.</p>

</div>
</div>
<a id="abda0a462ab3314e7198af36bf5e3e525" name="abda0a462ab3314e7198af36bf5e3e525"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abda0a462ab3314e7198af36bf5e3e525">&#9670;&#160;</a></span>ROT_VEL_MAX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ROT_VEL_MAX&#160;&#160;&#160;6000.0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>rotational velocity limit for tachometer [rot/min] </p>

<p class="definition">Definition at line <a class="el" href="sensors_8h_source.html#l00094">94</a> of file <a class="el" href="sensors_8h_source.html">sensors.h</a>.</p>

</div>
</div>
<a id="a06e646d1fd3953e71bc679f2781dc806" name="a06e646d1fd3953e71bc679f2781dc806"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06e646d1fd3953e71bc679f2781dc806">&#9670;&#160;</a></span>SENSOR_H</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SENSOR_H</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sensors_8h_source.html#l00043">43</a> of file <a class="el" href="sensors_8h_source.html">sensors.h</a>.</p>

</div>
</div>
<a id="af79064a5dbf95cf506bc27bdabbcf037" name="af79064a5dbf95cf506bc27bdabbcf037"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af79064a5dbf95cf506bc27bdabbcf037">&#9670;&#160;</a></span>TACHO_COUNTS_PER_REVOLUTION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TACHO_COUNTS_PER_REVOLUTION&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>tachometer resolution [counts/revolution] </p>

<p class="definition">Definition at line <a class="el" href="sensors_8h_source.html#l00098">98</a> of file <a class="el" href="sensors_8h_source.html">sensors.h</a>.</p>

</div>
</div>
<a id="acf1e0eab869bb642611ebd0ada384178" name="acf1e0eab869bb642611ebd0ada384178"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf1e0eab869bb642611ebd0ada384178">&#9670;&#160;</a></span>TACHOMETER_GPIO</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TACHOMETER_GPIO&#160;&#160;&#160;35</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>tachometer signal </p>

<p class="definition">Definition at line <a class="el" href="sensors_8h_source.html#l00061">61</a> of file <a class="el" href="sensors_8h_source.html">sensors.h</a>.</p>

</div>
</div>
<a id="a654e9b1744e01af0d5a98db783542e35" name="a654e9b1744e01af0d5a98db783542e35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a654e9b1744e01af0d5a98db783542e35">&#9670;&#160;</a></span>THROTTLE_IN_GPIO</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define THROTTLE_IN_GPIO&#160;&#160;&#160;34</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>pwm throttle command input </p>

<p class="definition">Definition at line <a class="el" href="sensors_8h_source.html#l00057">57</a> of file <a class="el" href="sensors_8h_source.html">sensors.h</a>.</p>

</div>
</div>
<a id="a0361e4ff120962e55ba00a7aeb499276" name="a0361e4ff120962e55ba00a7aeb499276"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0361e4ff120962e55ba00a7aeb499276">&#9670;&#160;</a></span>THROTTLE_OUT_GPIO</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define THROTTLE_OUT_GPIO&#160;&#160;&#160;33</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>pwm throttle command output </p>

<p class="definition">Definition at line <a class="el" href="sensors_8h_source.html#l00053">53</a> of file <a class="el" href="sensors_8h_source.html">sensors.h</a>.</p>

</div>
</div>
<a id="a3bd0f8a90f3ff4eb6a8da172f5b874ad" name="a3bd0f8a90f3ff4eb6a8da172f5b874ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3bd0f8a90f3ff4eb6a8da172f5b874ad">&#9670;&#160;</a></span>THROTTLE_STATIONARY_DUTY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define THROTTLE_STATIONARY_DUTY&#160;&#160;&#160;11.258452</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>speed controller duty cycle when motor is stopped [%] </p>

<p class="definition">Definition at line <a class="el" href="sensors_8h_source.html#l00106">106</a> of file <a class="el" href="sensors_8h_source.html">sensors.h</a>.</p>

</div>
</div>
<a id="a48e65c5aab10321436054a86e830a343" name="a48e65c5aab10321436054a86e830a343"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48e65c5aab10321436054a86e830a343">&#9670;&#160;</a></span>VELO_MEAS_PERIOD_MS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VELO_MEAS_PERIOD_MS&#160;&#160;&#160;200</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>sample rate for reading cumulated counts on tachometer [ms] </p>

<p class="definition">Definition at line <a class="el" href="sensors_8h_source.html#l00079">79</a> of file <a class="el" href="sensors_8h_source.html">sensors.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="ac61e98212a80fbe6dd044cba3585a698" name="ac61e98212a80fbe6dd044cba3585a698"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac61e98212a80fbe6dd044cba3585a698">&#9670;&#160;</a></span>measurements_data</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structmeasurements__data.html">measurements_data</a> <a class="el" href="structmeasurements__data.html">measurements_data</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Hold measurement values and a timestamp. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="abaee63e3d3ae27b5b347b34a61370ada" name="abaee63e3d3ae27b5b347b34a61370ada"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abaee63e3d3ae27b5b347b34a61370ada">&#9670;&#160;</a></span>get_distance()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float get_distance </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Compute distance from HC-SR04 measurements. Time of flight of the reflected ultrasound is halfed and multiplied by speed of sound (343 m/s) in order to get distance in meters. </p>
<p class="formulaDsp">
\begin{equation}distance = \frac{time\_of\_flight\_in\_ticks * 343}{2 * timer\_clock\_frequency\_Hz}\end{equation}
</p>
<dl class="section return"><dt>Returns</dt><dd>distance from nearest object [m] </dd></dl>

<p class="definition">Definition at line <a class="el" href="sensors_8c_source.html#l00242">242</a> of file <a class="el" href="sensors_8c_source.html">sensors.c</a>.</p>

</div>
</div>
<a id="a836ed20956f87c11ecceef6bd2155b05" name="a836ed20956f87c11ecceef6bd2155b05"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a836ed20956f87c11ecceef6bd2155b05">&#9670;&#160;</a></span>get_measurements()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void get_measurements </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structmeasurements__data.html">measurements_data</a> *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>get a #measurement_data instance with current measurements and a timestamp in microseconds. Time is retrieved via esp_timer::esp_timer_get_time(), measured since boot time. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pointer</td><td>to <a class="el" href="structmeasurements__data.html" title="Hold measurement values and a timestamp.">measurements_data</a> instance which will be updated </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="sensors_8c_source.html#l00257">257</a> of file <a class="el" href="sensors_8c_source.html">sensors.c</a>.</p>

</div>
</div>
<a id="a616528e35ee0a88227957f3671c9d78a" name="a616528e35ee0a88227957f3671c9d78a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a616528e35ee0a88227957f3671c9d78a">&#9670;&#160;</a></span>get_throttle_in_duty()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float get_throttle_in_duty </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get duty cycle measured on <a class="el" href="sensors_8h.html#a654e9b1744e01af0d5a98db783542e35" title="pwm throttle command input">THROTTLE_IN_GPIO</a>. </p>
<dl class="section return"><dt>Returns</dt><dd>duty cycle in percentage [%] </dd></dl>

<p class="definition">Definition at line <a class="el" href="sensors_8c_source.html#l00235">235</a> of file <a class="el" href="sensors_8c_source.html">sensors.c</a>.</p>

</div>
</div>
<a id="aae82ba7fadc40ef6388fb6e9e8d49b0d" name="aae82ba7fadc40ef6388fb6e9e8d49b0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae82ba7fadc40ef6388fb6e9e8d49b0d">&#9670;&#160;</a></span>get_velocity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float get_velocity </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get last tachometer measurement taken on <a class="el" href="sensors_8h.html#acf1e0eab869bb642611ebd0ada384178" title="tachometer signal">TACHOMETER_GPIO</a>. </p>
<p>Compute rotational velocity from tachometer data with the following formula: </p><p class="formulaDsp">
\begin{equation}rotational velocity = \frac{tachometer\_counts * 60000}{TACHO\_COUNTS\_PER\_REVOLUTION * VELO\_MEAS\_PERIOD\_MS}\end{equation}
</p>
<dl class="section return"><dt>Returns</dt><dd>rotational velocity [rot/min] </dd></dl>

<p class="definition">Definition at line <a class="el" href="sensors_8c_source.html#l00226">226</a> of file <a class="el" href="sensors_8c_source.html">sensors.c</a>.</p>

</div>
</div>
<a id="a61c686e72f94452c023d1513280d8a93" name="a61c686e72f94452c023d1513280d8a93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61c686e72f94452c023d1513280d8a93">&#9670;&#160;</a></span>measurements_to_csv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void measurements_to_csv </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structmeasurements__data.html">measurements_data</a> *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert measurement data into csv format, write result into <b>buffer</b>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>- char array destination </td></tr>
    <tr><td class="paramname">data</td><td>- a measurement_data struct </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="sensors_8c_source.html#l00265">265</a> of file <a class="el" href="sensors_8c_source.html">sensors.c</a>.</p>

</div>
</div>
<a id="ac5ec1d578591899e43c3515d05e573b7" name="ac5ec1d578591899e43c3515d05e573b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5ec1d578591899e43c3515d05e573b7">&#9670;&#160;</a></span>sensors_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sensors_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configure peripherals for sensors and actuators. </p>

<p class="definition">Definition at line <a class="el" href="sensors_8c_source.html#l00215">215</a> of file <a class="el" href="sensors_8c_source.html">sensors.c</a>.</p>

</div>
</div>
<a id="ab56e9687c1c23157ca48a4e2b7a344f9" name="ab56e9687c1c23157ca48a4e2b7a344f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab56e9687c1c23157ca48a4e2b7a344f9">&#9670;&#160;</a></span>set_throttle_duty()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_throttle_duty </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>duty</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set duty cycle for <a class="el" href="sensors_8h.html#a0361e4ff120962e55ba00a7aeb499276" title="pwm throttle command output">THROTTLE_OUT_GPIO</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">duty</td><td>- pwm duty cycle in percentage [%] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="sensors_8c_source.html#l00249">249</a> of file <a class="el" href="sensors_8c_source.html">sensors.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jun 19 2023 13:48:04 for rc-car by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
